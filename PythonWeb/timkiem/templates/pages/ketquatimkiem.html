{% extends "pages/basedetail.html" %}
{% load static %}

{% block title %}
    Kết quả tìm kiếm
{% endblock %}

{% block cssblock %}
    <!-- Icon css link -->
    <link href="{% static 'home/css/font-awesome.min.css' %}" rel="stylesheet">
    <link href="{% static 'home/vendors/line-icon/css/simple-line-icons.css' %}" rel="stylesheet">
    <link href="{% static 'home/vendors/elegant-icon/style.css' %}" rel="stylesheet">
    <!-- Bootstrap -->
    <link href="{% static 'home/css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Rev slider css -->
    <link href="{% static 'home/vendors/revolution/css/settings.css' %}" rel="stylesheet">
    <link href="{% static 'home/vendors/revolution/css/layers.css' %}" rel="stylesheet">
    <link href="{% static 'home/vendors/revolution/css/navigation.css' %}" rel="stylesheet">

    <!-- Extra plugin css -->
    <link href="{% static 'home/vendors/owl-carousel/owl.carousel.min.css' %}" rel="stylesheet">
    <link href="{% static 'home/vendors/bootstrap-selector/css/bootstrap-select.min.css' %}" rel="stylesheet">
    <link href="{% static 'home/vendors/vertical-slider/css/jQuery.verticalCarousel.css' %}" rel="stylesheet">

    <link href="{% static 'home/css/style.css' %}" rel="stylesheet">
    <link href="{% static 'home/css/responsive.css' %}" rel="stylesheet">
    <link href="{% static 'home/css/PagedList.css' %}" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'home/css/jquery-ui.css' %}">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .l_p_info {
            display: none;
        }
        .l_product_item:hover .l_p_info {
            height: 300px;
            display: block;
            font-size: 15px;
        }
        .l_product_item:hover .l_p_img {
            display: none;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="mb-3">
        <form style="max-width: 800px; margin: auto; margin-bottom: 10px;" method="get" action="{% url 'timkiem:ketquatimkiem' %}">
            <div class="advanced_search_area">
                <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="Tìm kiếm" aria-label="Search" value="{{request.GET.q}}">
                <span class="input-group-btn">
                    <button class="btn btn-secondary" type="submit"><i class="icon-magnifier icons"></i></button>
                </span>
            </div>
            </div>
            <div class="input-group">
                <input type="number" id="amount1" name="min" step="10000" style="border:1; color:#f6931f; font-weight:bold; float: left; text-align: center; margin-left: 20px; width: 120px;">
                <div id="slider-range" style="margin: 0px 10px; width: 500px; float: left;"></div>
                <input type="number" id="amount2" name="max" step="10000" style="border:1; color:#f6931f; font-weight:bold; float: left; text-align: center; width: 120px;">
            </div>
        </form>
        <h3 style="text-align:center; margin-bottom:10px; color: red;"></h3>
    </div>

    <section class="categories_banner_area">
        <div class="container">
            <div class="c_banner_inner" style="padding: 70px;">
                <h3>Kết quả tìm kiếm: {{request.GET.q}}</h3>
                <ul>
                    <li><a href="{% url 'sanpham:home' %}">Trang chủ</a></li>
                    <li><a href="{% url 'timkiem:ketquatimkiem' %}">Tìm kiếm sản phẩm</a></li>
                </ul>
            </div>
        </div>
    </section>

    <div class="row" style="margin-top:10px;">
        {% for sanpham in SanPhams %}
            <!--Kiểm tra giảm giá của sản phẩm-->
            {% if sanpham.GiamGia == 0 %}
                <style>
                    #giamgia_{{sanpham.id}} {
                        display: none;
                    }

                    #gia_{{sanpham.id}}{
                        display: none;
                    }
                </style>
            {% endif %}

            <!--Kiểm tra số lượng sản phẩm-->
            {% if sanpham.SoLuong == 0 %}
                <style>
                    #add_cart_{{sanpham.id}} {
                        cursor: not-allowed;
                        pointer-events: none;
                    }
                </style>
            {% else %}
                <style>
                    #hethang_{{sanpham.id}} {
                        display: none;
                    }
                </style>
            {% endif %}
            <div class="col-sm-3 col-lg-3 col-md-3">
                <div class="l_product_item">
                    <div class="l_p_img">
                        <a href="{% url 'sanpham:sanpham' sanpham.id %}" style="color: black;">
                            <img class="img-fluid" src="{{sanpham.Anh.url}}" style="width: 300px; height:300px;" alt="{{sanpham.TenSanPham}}">
                            <h5 id="giamgia_{{sanpham.id}}" class="sale">{{sanpham.GiamGia}}%</h5>
                            <h5 id="hethang_{{sanpham.id}}" class="sale">Hết hàng</h5>
                        </a>
                    </div>
                    <a href="{% url 'sanpham:sanpham' sanpham.id %}" style="color: black;">
                        <div class="l_p_info">
                            <span>Tên sản phẩm: {{sanpham.TenSanPham}}</span>
                            <br />
                            <span>Số lượng: {{sanpham.SoLuong}}</span>
                            <br />
                            <span>Giảm giá: {{sanpham.GiamGia}}%</span>
                            <br />
                            <span>Mô tả: {{sanpham.MoTa|slice:"0:100"}}...</span>
                        </div>
                    </a>
                    <div class="l_p_text">
                        <ul>
                            <li>
                                {% include 'pages/themvaogiohang.html'%}
                            </li>
                        </ul>
                        <h4 style="text-align: center;">{{sanpham.TenSanPham}}</h4>
                        <h5 id="gia_{{sanpham.id}}" style="text-align: center;"><del>{{sanpham.Gia}} VNĐ</del></h5>
                        <h5 style="text-align: center;">{{sanpham.GiaChinhThuc}} VNĐ</h5>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <!--Phân trang-->
    <div style="text-align:center;">
        {% if SanPhams.has_other_pages %}
            <ul class="pagination">
                {% if SanPhams.has_previous %}
                    <li><a href="?page={{ SanPhams.previous_page_number }}&q={{request.GET.q}}&min={{request.GET.min}}&max={{request.GET.max}}">&laquo;</a></li>
                {% else %}
                    <li class="disabled"><span>&laquo;</span></li>
                {% endif %}
                {% for i in SanPhams.paginator.page_range %}
                    {% if SanPhams.number == i %}
                        <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
                    {% else %}
                        <li><a href="?page={{ i }}&q={{request.GET.q}}&min={{request.GET.min}}&max={{request.GET.max}}">{{ i }}</a></li>
                    {% endif %}
                {% endfor %}
                {% if SanPhams.has_next %}
                    <li><a href="?page={{ SanPhams.next_page_number }}&q={{request.GET.q}}&min={{request.GET.min}}&max={{request.GET.max}}">&raquo;</a></li>
                {% else %}
                    <li class="disabled"><span>&raquo;</span></li>
                {% endif %}
            </ul>
        {% endif %}
    </div>
{% endblock  %}

{% block jsblock %}
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="{% static 'home/js/jquery-3.2.1.min.js' %}"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="{% static 'home/js/popper.min.js' %}"></script>
    <script src="{% static 'home/js/bootstrap.min.js' %}"></script>
    <!-- Rev slider js -->
    <script src="{% static 'home/vendors/revolution/js/jquery.themepunch.tools.min.js' %}"></script>
    <script src="{% static 'home/vendors/revolution/js/jquery.themepunch.revolution.min.js' %}"></script>
    <script src="{% static 'home/vendors/revolution/js/extensions/revolution.extension.actions.min.js' %}"></script>
    <script src="{% static 'home/vendors/revolution/js/extensions/revolution.extension.video.min.js' %}"></script>
    <script src="{% static 'home/vendors/revolution/js/extensions/revolution.extension.slideanims.min.js' %}"></script>
    <script src="{% static 'home/vendors/revolution/js/extensions/revolution.extension.layeranimation.min.js' %}"></script>
    <script src="{% static 'home/vendors/revolution/js/extensions/revolution.extension.navigation.min.js' %}"></script>
    <script src="{% static 'home/vendors/revolution/js/extensions/revolution.extension.slideanims.min.js' %}"></script>
    <!-- Extra plugin css -->
    <script src="{% static 'home/vendors/counterup/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'home/vendors/counterup/jquery.counterup.min.js' %}"></script>
    <script src="{% static 'home/vendors/owl-carousel/owl.carousel.min.js' %}"></script>
    <script src="{% static 'home/vendors/bootstrap-selector/js/bootstrap-select.min.js' %}"></script>
    <script src="{% static 'home/vendors/image-dropdown/jquery.dd.min.js' %}"></script>
    <script src="{% static 'home/js/smoothscroll.js' %}"></script>
    <script src="{% static 'home/vendors/isotope/imagesloaded.pkgd.min.js' %}"></script>
    <script src="{% static 'home/vendors/isotope/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'home/vendors/magnify-popup/jquery.magnific-popup.min.js' %}"></script>
    <script src="{% static 'home/vendors/vertical-slider/js/jQuery.verticalCarousel.js' %}"></script>
    <script src="{% static 'home/vendors/jquery-ui/jquery-ui.js' %}"></script>
    <script src="{% static 'home/js/theme.js' %}"></script>
    <script>
        var min = 0;
        var max = {{Max}};
        {% if request.GET.min %}
            min = {{request.GET.min}};
        {% endif %}
        {% if request.GET.max %}
            max = {{request.GET.max}};
        {% endif %}

        $( function() {

            $( "#slider-range" ).slider({
                range: true,
                min: 0,
                max: {{Max}},
                step: 10000,
                values: [ min, max ],
                slide: function( event, ui ) {
                    $("#amount1").val(ui.values[0]);
                    $("#amount2").val(ui.values[1]);
                }
            });
            $("#amount1").change(function() {
                $("#slider-range").slider('values',0,$(this).val());
            });
            $("#amount2").change(function() {
                $("#slider-range").slider('values',1,$(this).val());
            });

            var current = $("#slider-range").slider( "option", "values" );
            function getSanPhams(min, max)
            {
                $( "#amount1" ).val( min );
                $( "#amount2" ).val( max );
            }
            getSanPhams(current[0], current[1]);
        });
    </script>
{% endblock %}